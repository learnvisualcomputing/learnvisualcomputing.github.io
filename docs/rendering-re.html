<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>11&nbsp; Rendering Surface Scattering – Foundations of Visual Computing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./rendering-surface.html" rel="next">
<link href="./rendering-lightfield.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./rendering.html">Rendering</a></li><li class="breadcrumb-item"><a href="./rendering-re.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Rendering Surface Scattering</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Foundations of Visual Computing</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/learnvisualcomputing/learnvisualcomputing.github.io" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Foundations-of-Visual-Computing.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An Invitation to Visual Computing</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./hvs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Human Visual System</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hvs-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">From Light to Vision</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hvs-receptor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Photoreceptors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hvs-color.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Color Vision</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hvs-colorimetry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Colorimetry</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hvs-retinalmodel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modeling Retinal Computation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hvs-adaptation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Visual Adaptations and Constancy</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./rendering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rendering</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rendering-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rendering-radiometry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Radiometry and Photometry</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rendering-lightfield.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Light Field</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rendering-re.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Rendering Surface Scattering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rendering-surface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Modeling Material Surface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rendering-sss.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Volume and Subsurface Scattering Processes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rendering-rte.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Rendering Volume and Subsurface Scattering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rendering-nflux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">The N-Flux Theory</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./imaging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Imaging</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./imaging-optics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Imaging Optics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./imaging-sensor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Image Sensor Architecture</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./imaging-noise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Noise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./imaging-isp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Image Signal Processing</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./display.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Display</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./display-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Basic Principles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./display-impl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Implementation Technologies</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-chpt-mat-ss-brdf" id="toc-sec-chpt-mat-ss-brdf" class="nav-link active" data-scroll-target="#sec-chpt-mat-ss-brdf"><span class="header-section-number">11.1</span> BRDF</a>
  <ul class="collapse">
  <li><a href="#sec-chpt-mat-ss-brdf-approx" id="toc-sec-chpt-mat-ss-brdf-approx" class="nav-link" data-scroll-target="#sec-chpt-mat-ss-brdf-approx"><span class="header-section-number">11.1.1</span> A Useful Approximation</a></li>
  <li><a href="#isotropic-material" id="toc-isotropic-material" class="nav-link" data-scroll-target="#isotropic-material"><span class="header-section-number">11.1.2</span> Isotropic Material</a></li>
  </ul></li>
  <li><a href="#sec-chpt-mat-ss-reflectance" id="toc-sec-chpt-mat-ss-reflectance" class="nav-link" data-scroll-target="#sec-chpt-mat-ss-reflectance"><span class="header-section-number">11.2</span> Reflectance and Albedo</a>
  <ul class="collapse">
  <li><a href="#sec-chpt-mat-ss-reflectance-dhr" id="toc-sec-chpt-mat-ss-reflectance-dhr" class="nav-link" data-scroll-target="#sec-chpt-mat-ss-reflectance-dhr"><span class="header-section-number">11.2.1</span> Directional-Hemispherical Reflectance</a></li>
  <li><a href="#sec-chpt-mat-ss-reflectance-hdr" id="toc-sec-chpt-mat-ss-reflectance-hdr" class="nav-link" data-scroll-target="#sec-chpt-mat-ss-reflectance-hdr"><span class="header-section-number">11.2.2</span> Hemispherical-Directional Reflectance</a></li>
  <li><a href="#sec-chpt-mat-ss-reflectance-hhr" id="toc-sec-chpt-mat-ss-reflectance-hhr" class="nav-link" data-scroll-target="#sec-chpt-mat-ss-reflectance-hhr"><span class="header-section-number">11.2.3</span> Albedo and Hemispherical-Hemispherical Reflectance</a></li>
  </ul></li>
  <li><a href="#sec-chpt-mat-ss-re" id="toc-sec-chpt-mat-ss-re" class="nav-link" data-scroll-target="#sec-chpt-mat-ss-re"><span class="header-section-number">11.3</span> The Rendering Equation</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/learnvisualcomputing/learnvisualcomputing.github.io/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./rendering.html">Rendering</a></li><li class="breadcrumb-item"><a href="./rendering-re.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Rendering Surface Scattering</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-chpt-mat-ss" class="quarto-section-identifier"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Rendering Surface Scattering</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="hidden">
<p><span class="math display">\[
\def\oi{{\omega_i}}
\def\os{{\omega_s}}
\def\Oi{{\Omega_i}}
\def\Os{{\Omega_s}}
\def\d{{\text{d}}}
\def\D{{\Delta}}
\def\do{{\d\omega}}
\def\Do{{\Delta\omega}}
\def\doi{{\d\omega_i}}
\def\dos{{\d\omega_s}}
\def\Doi{{\D\omega_i}}
\def\Dos{{\D\omega_s}}
\def\H{{\mathbf{H}}}
\newcommand{\cM}{\mathcal{M}}
\newcommand{\cL}{\mathcal{L}}
\]</span></p>
</div>
<p>When a group of photons arrives at a material surface, some of the photons might be immediately turned away (i.e., reflected) while others might penetrate into the material (i.e., refracted). The refracted portion is scattered further inside the material, giving rise to subsurface scattering. Let’s focus first on surface scattering, ignoring the contribution of surface scattering to an object’s appearance.</p>
<p>There are two properties we care about in surface scattering: the directions of the reflection and the (spectral) energy along each direction. The direction is important because, as far as rendering, human vision, or camera imaging are concerned, only the photons that will eventually captured by a detector matter. The (spectral) energy is important because it dictates the perceived color. These two properties are captured by what is known as the BRDF (<a href="#sec-chpt-mat-ss-brdf" class="quarto-xref"><span>Section 11.1</span></a>). We will then derive a few very useful equations and properties based on BRDF (<a href="#sec-chpt-mat-ss-reflectance" class="quarto-xref"><span>Section 11.2</span></a>). Given the BRDF, we will introduce the rendering equation, the theoretical tool for rendering surface scattering (<a href="#sec-chpt-mat-ss-re" class="quarto-xref"><span>Section 11.3</span></a>).</p>
<section id="sec-chpt-mat-ss-brdf" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="sec-chpt-mat-ss-brdf"><span class="header-section-number">11.1</span> BRDF</h2>
<p>Generally, the energy distribution of the surface scattering is captured by the Bidirectional Reflectance Distribution Function (<strong>BRDF</strong>) <span class="citation" data-cites="nicodemus1977geometrical">(<a href="references.html#ref-nicodemus1977geometrical" role="doc-biblioref">Nicodemus et al. 1977</a>)</span>. Informally, it tells us how the incident energy from a particular direction is distributed to different exiting directions. The BRDF is parameterized by three parameters: a surface point <span class="math inline">\(p\)</span>, the direction of light incident on <span class="math inline">\(p\)</span>, denoted <span class="math inline">\(\oi\)</span>, and the direction of light leaving <span class="math inline">\(p\)</span>, denoted <span class="math inline">\(\os\)</span>. So the BRDF is usually written as <span class="math inline">\(f_r(p, \os, \oi)\)</span>.</p>
<p>The way to understand BRDF <span class="math inline">\(f_r(p, \os, \oi)\)</span> is to consider the following. <span class="math inline">\(L(p, \os)\)</span>, i.e., the radiance leaving <span class="math inline">\(p\)</span> toward <span class="math inline">\(\os\)</span>, is dependent on the light incident on <span class="math inline">\(p\)</span>. When the incident light on <span class="math inline">\(p\)</span> comes from only the direction <span class="math inline">\(\oi\)</span>, the irradiance at <span class="math inline">\(p\)</span> is zero, since the solid angle of a single direction <span class="math inline">\(\oi\)</span> is zero, so naturally <span class="math inline">\(L(p, \os)\)</span> is 0 (assuming there is no other light hitting <span class="math inline">\(p\)</span>). When <span class="math inline">\(p\)</span> receives light from a non-zero solid angle of directions <span class="math inline">\(\Delta\oi\)</span> (centered around <span class="math inline">\(\oi\)</span>), the irradiance of <span class="math inline">\(p\)</span> is increased by <span class="math inline">\(\Delta E(p, \oi)\)</span>. At the same time, due to this increase in incident light, <span class="math inline">\(L(p, \os)\)</span> is no longer zero; the increase in the radiance leaving <span class="math inline">\(p\)</span> over <span class="math inline">\(\os\)</span> is denoted <span class="math inline">\(\Delta L(p, \os)\)</span>.</p>
<p>As we increase <span class="math inline">\(\Delta \oi\)</span>, both <span class="math inline">\(\Delta E(p, \oi)\)</span> and <span class="math inline">\(\Delta L(p, \os)\)</span> increase. BRDF is defined as the ratio of the two <em>increments</em> when <span class="math inline">\(\Delta \oi\)</span> approaches 0 (when the radiance along all directions in <span class="math inline">\(\Delta \oi\)</span> can be thought of as a constant):</p>
<p><span id="eq-brdf"><span class="math display">\[
    f_r(p, \os, \oi) = \lim_{\Delta \oi \rightarrow 0}\frac{\Delta L(p, \os)}{\Delta E(p, \oi)} = \frac{\text{d}L(p, \os)}{\text{d}E(p, \oi)} = \frac{\text{d}L(p, \os)}{L(p, \oi)\cos\theta_i \text{d}\oi}.
\tag{11.1}\]</span></span></p>
<section id="sec-chpt-mat-ss-brdf-approx" class="level3" data-number="11.1.1">
<h3 data-number="11.1.1" class="anchored" data-anchor-id="sec-chpt-mat-ss-brdf-approx"><span class="header-section-number">11.1.1</span> A Useful Approximation</h3>
<p>Now assume that we illuminate <span class="math inline">\(p\)</span> through a finite, but small, solid angle <span class="math inline">\(\Oi\)</span>. Turning the differential equation into an integral equation, we get:</p>
<p><span id="eq-brdf_finite_1"><span class="math display">\[
    L(p, \os) = \int^{\Oi} f_r(p, \os, \oi) \text{d}E(p, \oi).
\tag{11.2}\]</span></span></p>
<p>Using the definition of radiance in <a href="rendering-radiometry.html#eq-radiance_3" class="quarto-xref">Equation&nbsp;<span>9.4</span></a>, we get: <span id="eq-brdf_finite_2"><span class="math display">\[
    L(p, \os) = \int^{\Oi} f_r(p, \os, \oi) L(p, \oi)\cos\theta_i \text{d}\oi.
\tag{11.3}\]</span></span></p>
<p>If we assume that the BRDF is a constant over all the directions in <span class="math inline">\(\Oi\)</span>, <a href="#eq-brdf_finite_2" class="quarto-xref">Equation&nbsp;<span>11.3</span></a> is simplified to:</p>
<p><span id="eq-brdf_finite_3"><span class="math display">\[
    L(p, \os) \approx f_r(p, \os, \oi) \int^{\Oi} L(p, \oi)\cos\theta_i \text{d}\oi.
\tag{11.4}\]</span></span></p>
<p>The integration in <a href="#eq-brdf_finite_3" class="quarto-xref">Equation&nbsp;<span>11.4</span></a> has no analytical solution, since we do not know the analytical form of <span class="math inline">\(L(p, \oi)\)</span>, but we know the integration is just another way of expressing the total irradiance incident upon <span class="math inline">\(p\)</span> over <span class="math inline">\(\Oi\)</span>, which is denoted as <span class="math inline">\(E(p, \Oi)\)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. This gets us <a href="#eq-brdf_finite_4" class="quarto-xref">Equation&nbsp;<span>11.5</span></a>:</p>
<p><span id="eq-brdf_finite_4"><span class="math display">\[
    L(p, \os) \approx f_r(p, \os, \oi) E(p, \Oi).
\tag{11.5}\]</span></span></p>
<p>Thus, we can approximate the BRDF as: <span id="eq-brdf_finite_5"><span class="math display">\[
    f_r(p, \os, \oi) \approx \frac{L(p, \os)}{E(p, \Oi)}.
\tag{11.6}\]</span></span></p>
<p>Ultimately, we can see from <a href="#eq-brdf_finite_5" class="quarto-xref">Equation&nbsp;<span>11.6</span></a> that the BRDF <span class="math inline">\(f_r(p, \os, \oi)\)</span> can also be calculated as the ratio between the <em>absolute</em> radiance <span class="math inline">\(L(p, \oi)\)</span> and the absolute irradiance <span class="math inline">\(E(p, \Oi)\)</span> illuminated from a very small, but finite solid angle <span class="math inline">\(\Oi\)</span>. Another way to interpret this is that the so-calculated BRDF is the average BRDF over <span class="math inline">\(\Oi\)</span>. This derivation is useful for actually measuring a BRDF, which we will discuss in <a href="rendering-surface.html#sec-chpt-mat-rt-brdf" class="quarto-xref"><span>Section 12.3.2</span></a>, where we will have no choice but to use a non-zero solid angle for illumination, because physically we just cannot illuminate a point through an infinitesimal solid angle <span class="math inline">\(\doi\)</span>.</p>
</section>
<section id="isotropic-material" class="level3" data-number="11.1.2">
<h3 data-number="11.1.2" class="anchored" data-anchor-id="isotropic-material"><span class="header-section-number">11.1.2</span> Isotropic Material</h3>
<p>A 3D direction <span class="math inline">\(\omega\)</span> expressed in the Cartesian coordinate system can also be expressed by two 2D planar angles in the spherical coordinate system: the polar angle <span class="math inline">\(\theta\)</span> and the azimuthal angle <span class="math inline">\(\phi\)</span>. So BRDF can also be parameterized as <span class="math inline">\(f_r(p, \theta_s, \phi_s, \theta_i, \phi_i)\)</span>. A material is <strong>isotropic</strong> if its BRDF satisfies <span class="math inline">\(f_r(p, \theta_s, \phi_s, \theta_i, \phi_i) = f_r(p, \theta_s, \phi_s+x, \theta_i, \phi_i+x)\)</span> for any <span class="math inline">\(x\)</span>. An intuitive way to think of an isotropic material is this: if you pick a point <span class="math inline">\(p\)</span> and rotate the material about the normal vector at <span class="math inline">\(p\)</span>, the color of <span class="math inline">\(p\)</span> does not change. This is because rotation about the normal vector keeps <span class="math inline">\(\theta_i\)</span> and <span class="math inline">\(\theta_s\)</span> unchanged and varies <span class="math inline">\(\phi_i\)</span> and <span class="math inline">\(\phi_s\)</span> by the same amount.</p>
<p>The nice thing about an isotropic BRDF is it can be parameterized with one fewer degree of freedom: <span class="math inline">\(f_r(p, \theta_s, \phi_s - \phi_i, \theta_i)\)</span>. This is because it is <span class="math inline">\((\phi_i - \phi_s)\)</span> rather than the specific values of <span class="math inline">\(\phi_s\)</span> or <span class="math inline">\(\phi_i\)</span> that matter.</p>
</section>
</section>
<section id="sec-chpt-mat-ss-reflectance" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="sec-chpt-mat-ss-reflectance"><span class="header-section-number">11.2</span> Reflectance and Albedo</h2>
<p>The BRDF does not have to be a value between 0 and 1. Let’s say that there is 100 J of energy incident on a point coming from a solid angle <span class="math inline">\(\Delta \oi\)</span>. That amount of energy is distributed across all the outgoing directions in the hemisphere, which forms a solid angle of <span class="math inline">\(4\pi/2 = 2\pi\)</span>. So on average the energy exiting per direction is <span class="math inline">\(\frac{100}{2\pi}J\)</span>, which clearly is greater than 1. This is not surprising, since BRDF is ultimately a <em>density</em> measure, a <em>distribution</em>, which is most meaningful when it is integrated to calculate some quantity. Integrating the BRDF gives a percentage/fraction measure between 0 and 1, i.e., reflectance, which we will discuss next.</p>
<section id="sec-chpt-mat-ss-reflectance-dhr" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="sec-chpt-mat-ss-reflectance-dhr"><span class="header-section-number">11.2.1</span> Directional-Hemispherical Reflectance</h3>
<p>For the energy to be conserved, the total outgoing energy at any point must not exceed that of the incident energy received by that point. Assume that a point <span class="math inline">\(p\)</span> receives an irradiance <span class="math inline">\(\d E_i\)</span> from a direction <span class="math inline">\(\oi\)</span> over an infinitesimal solid angle <span class="math inline">\(\doi\)</span>, and the outgoing radiance along the direction <span class="math inline">\(\os\)</span> due to that irradiance is <span class="math inline">\(f_r(p, \os, \oi)\d E_i\)</span>. Then the outgoing irradiance leaving <span class="math inline">\(p\)</span> over an infinitesimal solid angle <span class="math inline">\(\dos\)</span> around <span class="math inline">\(\os\)</span> would be <span class="math inline">\(f_r(p, \os, \oi)\d E_i\cos\theta_s\dos\)</span>. If we integrate all the outgoing directions <span class="math inline">\(\Omega\)</span>, we get the total outgoing irradiance <span class="math inline">\(\d E_o\)</span>, which must not exceed the incident irradiance <span class="math inline">\(\d E_i\)</span>:</p>
<p><span id="eq-energy_con_0"><span class="math display">\[
    \d E_o = \int^{\Omega} \d E_i f_r(p, \os, \oi) \cos\theta_s\text{d}\os.
\tag{11.7}\]</span></span></p>
<p><span class="math inline">\(\d E_i\)</span> is independent of <span class="math inline">\(\os\)</span>, so it can be hoisted out of the integration. Therefore, we have the following equation, which holds for any arbitrary incident direction <span class="math inline">\(\oi\)</span>:</p>
<p><span id="eq-energy_con_1"><span class="math display">\[
    \int^{\Omega}f_r(p, \os, \oi)\cos\theta_s\text{d}\os = \frac{\d E_o}{\d E_i} = \rho_{dh}(p, \oi) \leq 1.
\tag{11.8}\]</span></span></p>
<p><span class="math inline">\(\rho_{dh}\)</span> is defined as the ratio between <span class="math inline">\(\d E_o\)</span> and <span class="math inline">\(\d E_i\)</span>. When <span class="math inline">\(\Omega\)</span> is the hemisphere, <span class="math inline">\(\rho_{dh}\)</span> is called the <strong>directional-hemispherical reflectance</strong> in the computer vision and graphics literature, and is interpreted as the percentage of energy scattered by a point over the entire hemisphere given the incident light from a particular direction. Clearly, <span class="math inline">\(\rho_{dh}\)</span> is a function of both <span class="math inline">\(p\)</span> and <span class="math inline">\(\oi\)</span> and takes a value between 0 and 1.</p>
</section>
<section id="sec-chpt-mat-ss-reflectance-hdr" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="sec-chpt-mat-ss-reflectance-hdr"><span class="header-section-number">11.2.2</span> Hemispherical-Directional Reflectance</h3>
<p>Since we are dealing with geometric optics, the Helmholtz reciprocity holds:</p>
<p><span class="math display">\[
    f_r(p, \os, \oi) = f_r(p, \oi, \os),
\]</span></p>
<p>which means the energy conservation can also be expressed as:</p>
<p><span id="eq-energy_con_2"><span class="math display">\[
    \int^{\Omega}f_r(p, \os, \oi)\cos\theta_i\text{d}\oi = \rho_{hd}(p, \os) \leq 1,
\tag{11.9}\]</span></span></p>
<p>where <span class="math inline">\(\rho_{hd}\)</span> is called the <strong>hemispherical-directional reflectance</strong> when <span class="math inline">\(\Omega\)</span> is the hemisphere. <span class="math inline">\(\rho_{hd}\)</span>, a function of <span class="math inline">\(p\)</span> and <span class="math inline">\(\os\)</span>, is interpreted as the percentage of energy reflected toward a particular direction <span class="math inline">\(\os\)</span> given the incident energy over the entire hemisphere.</p>
<p><a href="#eq-energy_con_2" class="quarto-xref">Equation&nbsp;<span>11.9</span></a> can be derived by first rewriting <a href="#eq-energy_con_1" class="quarto-xref">Equation&nbsp;<span>11.8</span></a> as <span class="math inline">\(\int^{\Omega}f_r(p, \oi, \os)\cos\theta_s\text{d}\os \leq 1\)</span> (using the reciprocity) followed by switching <span class="math inline">\(\os\)</span> and <span class="math inline">\(\oi\)</span> (simply a change of notation). This derivation suggests that <span class="math inline">\(\rho_{hd}(p, \oi) = \rho_{dh}(p, \os)\)</span>, a natural consequence of the reciprocity<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
</section>
<section id="sec-chpt-mat-ss-reflectance-hhr" class="level3" data-number="11.2.3">
<h3 data-number="11.2.3" class="anchored" data-anchor-id="sec-chpt-mat-ss-reflectance-hhr"><span class="header-section-number">11.2.3</span> Albedo and Hemispherical-Hemispherical Reflectance</h3>
<p>We can also describe the relationship between all the outgoing irradiance <span class="math inline">\(E_o\)</span> of a point over a solid angle <span class="math inline">\(\Os\)</span> due to all the incident irradiance <span class="math inline">\(E_i\)</span> over a solid angle <span class="math inline">\(\Oi\)</span>:</p>
<p><span id="eq-albedo_0"><span class="math display">\[
\begin{aligned}
    E_o &amp;= \int^{\Omega_s} \Big(\int^{\Omega_i} f_r(p, \os, \oi) L(p, \oi) \cos\theta_i\text{d}\oi\Big) \cos\theta_s \dos, \\
    E_i &amp;= \int^{\Omega_i} L(p, \oi) \cos\theta_i\text{d}\oi
\end{aligned}
\tag{11.10}\]</span></span></p>
<p>Due to energy conservation, we have:</p>
<p><span id="eq-albedo_1"><span class="math display">\[
    \rho_{hh}(p) = \frac{E_o}{E_i} \leq 1.
\tag{11.11}\]</span></span></p>
<p><a href="#eq-albedo_1" class="quarto-xref">Equation&nbsp;<span>11.11</span></a> defines <span class="math inline">\(\rho_{hh}\)</span>, which is called the <strong>hemispherical-hemispherical reflectance</strong> when both <span class="math inline">\(\Omega_i\)</span> and <span class="math inline">\(\Omega_s\)</span> are hemispheres. <span class="math inline">\(\rho_{hh}\)</span> has another name: <strong>albedo</strong>.</p>
<p>When <span class="math inline">\(f_r(p, \os, \oi)\)</span> is independent of (invariant to) <span class="math inline">\(\oi\)</span> and <span class="math inline">\(\os\)</span>, i.e., when <span class="math inline">\(p\)</span> is an ideal <strong>Lambertian</strong> surface (see <a href="rendering-surface.html#sec-chpt-mat-ss-mat" class="quarto-xref"><span>Section 12.1</span></a>), <a href="#eq-albedo_0" class="quarto-xref">Equation&nbsp;<span>11.10</span></a> can be re-written as:</p>
<p><span id="eq-lamb_0"><span class="math display">\[
    E_o = \int^{\Omega_s} f_r(p, \os, \oi) (\int^{\Omega_i} L(p, \oi) \cos\theta_i\text{d}\oi) \cos\theta_s \dos.
\tag{11.12}\]</span></span></p>
<p>Plugging in the definition of <span class="math inline">\(E_i\)</span> from <a href="#eq-albedo_0" class="quarto-xref">Equation&nbsp;<span>11.10</span></a>, we have: <span id="eq-lamb_1"><span class="math display">\[
    E_o = \int^{\Omega_s} f_r(p, \os, \oi) E_i \cos\theta_s \dos.
\tag{11.13}\]</span></span></p>
<p>Since <span class="math inline">\(E_i\)</span> is independent of <span class="math inline">\(\os\)</span>, we have:</p>
<p><span id="eq-lamb_2"><span class="math display">\[
    E_o = E_i  \int^{\Omega_s} f_r(p, \os, \oi) \cos\theta_s \dos.
\tag{11.14}\]</span></span></p>
<p>Using the definition of <span class="math inline">\(\rho_{dh}\)</span> in <a href="#eq-energy_con_1" class="quarto-xref">Equation&nbsp;<span>11.8</span></a>, we have:</p>
<p><span id="eq-lamb_3"><span class="math display">\[
    E_o = E_i \rho_{dh}(p, \oi).
\tag{11.15}\]</span></span></p>
<p>Comparing <a href="#eq-lamb_3" class="quarto-xref">Equation&nbsp;<span>11.15</span></a> and <a href="#eq-albedo_1" class="quarto-xref">Equation&nbsp;<span>11.11</span></a>, we can see that for a Lambertian surface the albedo (<span class="math inline">\(\rho_{hh}\)</span>) is equivalent to <span class="math inline">\(\rho_{dh}\)</span> and <span class="math inline">\(\rho_{hd}\)</span>, but this relationship is not true in general.</p>
<p>We can also show that for a Lambertian surface, the BRDF is the constant <span class="math inline">\(\frac{\rho_{hh}}{\pi}\)</span>. Starting from <a href="#eq-lamb_2" class="quarto-xref">Equation&nbsp;<span>11.14</span></a> and using the assumption that <span class="math inline">\(f_r(p, \os, \oi)\)</span> is independent of <span class="math inline">\(\os\)</span>:</p>
<p><span id="eq-lamb_4"><span class="math display">\[
\begin{aligned}
    E_o = E_i \rho_{hh} &amp;= E_i  \int^{\Omega_s} f_r(p, \os, \oi) \cos\theta_s \dos \\
    &amp;= E_i f_r(p, \os, \oi) \int^{\Omega_s} \cos\theta_s \dos \\
    &amp;= E_i f_r(p, \os, \oi) \pi.
\end{aligned}
\tag{11.16}\]</span></span></p>
<p>Thus: <span id="eq-diffuse_brdf"><span class="math display">\[
    f_r(p, \os, \oi) = \frac{\rho_{hh}}{\pi}.
\tag{11.17}\]</span></span></p>
<p>The last step in <a href="#eq-lamb_4" class="quarto-xref">Equation&nbsp;<span>11.16</span></a> uses the integral results that:</p>
<p><span class="math display">\[
\begin{aligned}
    \d\omega &amp;= \sin\theta\d\theta\d\phi, \\
    \int^{\Omega=2\pi} \cos\theta \d\omega &amp;= \int^{2\pi}_0 \int^{\pi/2}_{0} \cos\theta \sin\theta\d\theta\d\phi \nonumber\\
    &amp;= 2\pi\int^{\pi/2}_{0} \cos\theta \sin\theta\d\theta \nonumber \\
    &amp;= \pi,
\end{aligned}
\]</span></p>
<p>when <span class="math inline">\(\Omega\)</span> is the hemisphere.</p>
<p>A fun exercise you can entertain yourself with is to show that if <span class="math inline">\(f_r\)</span> is independent of <span class="math inline">\(\oi\)</span>, it must also be independent of <span class="math inline">\(\os\)</span>. An informal way to do so is the following. Since <span class="math inline">\(f_r(p, \os, \oi)\)</span> is independent of <span class="math inline">\(\oi\)</span>, let’s rewrite it as <span class="math inline">\(g(p, \os)\)</span>. Now we invoke the reciprocity and rewrite <span class="math inline">\(f_r(p, \os, \oi)\)</span> as <span class="math inline">\(g(p, \oi)\)</span>. The only way for <span class="math inline">\(g(p, \os) = g(p, \oi)\)</span> is for <span class="math inline">\(g\)</span> to be dependent only on <span class="math inline">\(p\)</span>.</p>
<p>Finally, one can also define the <strong>directional-directional reflectance</strong>, which is naturally a function of both the incident direction and outgoing direction and can be defined as the ratio between the incident irradiance and the outgoing irradiance when both the incident and outgoing solid angles approach 0.</p>
<p>BRDF and directional-directional reflectance are both sensitive to both the incident and outgoing directions. But the former is a density measure, whereas the latter is a fraction/percentage measure (all other reflectance quantities are fraction measures too). Integrating BRDF over a finite set of directions gives us some measure reflectance. This is why the BRDF is defined as the radiance/ irradiance ratio rather than radiance/radiance or irradiance/irradiance ratio; it is to reflect the fact that the energy of a small cone of incident directions is distributed over all the directions over the hemisphere, and what we care to characterize is the <em>distribution</em> of the incident energy over all outgoing directions.</p>
</section>
</section>
<section id="sec-chpt-mat-ss-re" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="sec-chpt-mat-ss-re"><span class="header-section-number">11.3</span> The Rendering Equation</h2>
<p>Given the BRDF, we can estimate the outgoing radiance of a point given its illumination using the well-known <strong>Rendering Equation</strong>.</p>
<p>The setup is that we have a surface on which there is a point <span class="math inline">\(p\)</span> that is receiving light from a solid angle <span class="math inline">\(\Omega\)</span>. We are interested in calculating the exiting radiance leaving <span class="math inline">\(p\)</span> toward an arbitrary direction <span class="math inline">\(\os\)</span>. The rendering equation formulates this calculation by:</p>
<p><span id="eq-re"><span class="math display">\[
    L(p, \os) = \int^{\Omega} f_r(p, \os, \oi) L(p, \oi) \cos\theta_i \text{d}\oi,
\tag{11.18}\]</span></span></p>
<p>where <span class="math inline">\(L(p, \os)\)</span> is the outgoing radiance from <span class="math inline">\(p\)</span> toward the direction <span class="math inline">\(\os\)</span>; <span class="math inline">\(\Omega\)</span> is usually a hemisphere in surface scattering, since lights hitting a surface point can come from anywhere in the hemisphere, in which case <a href="#eq-re" class="quarto-xref">Equation&nbsp;<span>11.18</span></a> is also called the <em>reflection equation</em>, indicating the fact that the equation governs surface reflection/scattering. The rendering equation was first introduced to computer graphics by <span class="citation" data-cites="kajiya1986rendering">Kajiya (<a href="references.html#ref-kajiya1986rendering" role="doc-biblioref">1986</a>)</span> and <span class="citation" data-cites="immel1986radiosity">Immel, Cohen, and Greenberg (<a href="references.html#ref-immel1986radiosity" role="doc-biblioref">1986</a>)</span> (albeit with slightly different formulations and the former being more general than the latter).</p>
<p>The rendering equation is exactly the same equation in <a href="#eq-brdf_finite_2" class="quarto-xref">Equation&nbsp;<span>11.3</span></a>, so there is nothing more profound about the rendering equation than the definition of the BRDF: we are simply following the BRDF’s definition and turning the differential equation into an integral one. Intuitively, the way to understand this equation is that every ray that hits <span class="math inline">\(p\)</span> makes some contribution toward the outgoing radiance <span class="math inline">\(L(p, \os)\)</span>, and the integration just accumulates all the contributions. In particular:</p>
<ul>
<li><span class="math inline">\(L(p, \oi) \text{d}\oi\)</span> is the incident irradiance of a differential solid angle <span class="math inline">\(\text{d}\oi\)</span>; note that the irradiance calculated here is defined with respect to a surface perpendicular to the direction of <span class="math inline">\(\oi\)</span>.</li>
<li><span class="math inline">\(L(p, \oi) \cos\theta \text{d}\oi\)</span> applies the Lambert’s cosine law and calculates the irradiance at the surface where <span class="math inline">\(p\)</span> lies.</li>
<li><span class="math inline">\(f_r(p, \os, \oi)L(p, \oi) \cos\theta \text{d}\oi\)</span> “transfers” the differential incident irradiance to the differential outgoing radiance toward <span class="math inline">\(\os\)</span> through the BRDF function.</li>
<li>The integration over all the incident directions calculates the total outgoing radiance given all the incident lights.</li>
</ul>
<p>The rendering equation in theory allows us to calculate the entire light field, i.e., the radiance distribution in space, given an arbitrary <span class="math inline">\(p\)</span> and <span class="math inline">\(\os\)</span>. Why is knowing the light field important? Recall <a href="rendering-lightfield.html#eq-cam" class="quarto-xref">Equation&nbsp;<span>10.1</span></a>: knowing the light field allows us to synthesize any image or calculate the color of any object from any perspective.</p>
<p>It is, of course, much easier said than done when it comes to solving the rendering equation, which itself is worth multiple chapters in a computer graphics textbook. We will not get into it here; let’s just consider the following challenges. First, the integrand in <a href="#eq-re" class="quarto-xref">Equation&nbsp;<span>11.18</span></a> generally has no analytical form, so we will not be able to get an analytical solution to the integral equation. A common method is Monte-Carlo integration, which samples the integrand at different points and estimates the integral from the samples.</p>
<p>Second, in a realistic environment, we need to solve the rendering equation <em>recursively</em>. Note how the radiance function shows up on both sides of the equation. Put it in another way, when using Monte-Carlo integration to solve <a href="#eq-re" class="quarto-xref">Equation&nbsp;<span>11.18</span></a> we need to sample the value of <span class="math inline">\(L(p, \oi)\)</span> for a specific <span class="math inline">\(\oi\)</span> — how? We evaluate <a href="#eq-re" class="quarto-xref">Equation&nbsp;<span>11.18</span></a> again, but this time treating <span class="math inline">\(\oi\)</span> as the <span class="math inline">\(\os\)</span>, which means we invoke Monte Carlo integration again. You can see how this can quickly blow up the computation: the number of rays whose radiances we need to calculate exponentially increases as long as we need to sample more than one ray at each point. A big chunk of physically-based graphics is devoted to addressing this issue; the most commonly used strategy is called <strong>path tracing</strong>, for which <span class="citation" data-cites="pharr2023physically">Pharr, Jakob, and Humphreys (<a href="references.html#ref-pharr2023physically" role="doc-biblioref">2023</a>, Chpt. 13)</span> is a great reference.</p>
<p>Another way to think of this is that there are infinitely many paths through which light can propagate and be incident on a point. A <strong>global illumination</strong> method for rendering would attempt to track all these paths (e.g., through Monte Carlo methods). In contrast, a <strong>local illumination</strong> method is concerned with only a small subset of these paths, in which case we might be able to evaluate the rendering equation as a single-pass integration while avoiding recursion. For instance, we might consider lights only from direct light sources. We will see the counterpart of this exact situation in surface scattering/volume rendering in <a href="rendering-rte.html" class="quarto-xref"><span>Chapter 14</span></a>. For this reason, the rendering equation is sometimes called the <strong>light transport equation</strong> (LTE), because it in principle captures how light is transported in space<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>An interesting, and approximate, global illumination method that avoids path tracing is the idea of <strong>environment map</strong> <span class="citation" data-cites="ramamoorthi2009precomputation">(<a href="references.html#ref-ramamoorthi2009precomputation" role="doc-biblioref">Ramamoorthi 2009</a>, Chpt. 3)</span>. It assumes that the light sources are so distant from the objects in the scene that all points in the scene receive the same incident radiance distribution. That is, <span class="math inline">\(L(p, \oi)\)</span> in <a href="#eq-re" class="quarto-xref">Equation&nbsp;<span>11.18</span></a> is a function of only <span class="math inline">\(\oi\)</span> but not <span class="math inline">\(p\)</span>. We can then pre-compute (through path tracing for instance) or directly measure <span class="math inline">\(L(\oi)\)</span> offline and store them in a data structure. For instance, we can use the equirectangular projection to store a discretized form of <span class="math inline">\(L(\oi)\)</span>, or use spherical harmonics to (approximately) store a parameterized form of <span class="math inline">\(L(\oi)\)</span>. Either way, the data structure that stores pre-computed <span class="math inline">\(L(\oi)\)</span> is called an environment map, which we can load at rendering time, plug it into the rendering equation, and calculate the outgoing radiance by simply evaluating the integral.</p>
<p>Finally, we also need to somehow know the BRDF of the material. There are generally two methods of going about it. We can, of course, measure it, but we have no realistic way of measuring the complete BRDF for a material, because we would have to measure infinitely many points and, for each point, infinitely many incident and outgoing directions. We can only sample the BRDF using something called a <em>goniospectroreflectometer</em> or a <em>goniospectrophotometer</em> <span class="citation" data-cites="judd1975color">(<a href="references.html#ref-judd1975color" role="doc-biblioref">Judd and Wyszecki 1975, p. 402–10</a>)</span>, but there is still a massive amount of samples we need to take and to store. Lots of prior work goes into efficiently sampling, measuring, and deriving BRDFs <span class="citation" data-cites="marschner2000image matusik2003data pharr2023physically">(<a href="references.html#ref-marschner2000image" role="doc-biblioref">Marschner et al. 2000</a>; <a href="references.html#ref-matusik2003data" role="doc-biblioref">Matusik 2003</a>; <a href="references.html#ref-pharr2023physically" role="doc-biblioref">Pharr, Jakob, and Humphreys 2023</a>, Chpt. 9.8)</span>.</p>
<p>Another approach is to parameterize the BRDF so that we can evaluate the BRDF on demand rather than storing all the BRDF data, and this is what we will study next.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-immel1986radiosity" class="csl-entry" role="listitem">
Immel, David S, Michael F Cohen, and Donald P Greenberg. 1986. <span>“A Radiosity Method for Non-Diffuse Environments.”</span> <em>Acm Siggraph Computer Graphics</em> 20 (4): 133–42.
</div>
<div id="ref-judd1975color" class="csl-entry" role="listitem">
Judd, Deane B, and Günter Wyszecki. 1975. <em>Color in Business, Science, and Industry</em>. 3rd ed. John Wiley &amp; Sons.
</div>
<div id="ref-kajiya1986rendering" class="csl-entry" role="listitem">
Kajiya, James T. 1986. <span>“The Rendering Equation.”</span> In <em>Proceedings of the 13th Annual Conference on Computer Graphics and Interactive Techniques</em>, 143–50.
</div>
<div id="ref-marschner2000image" class="csl-entry" role="listitem">
Marschner, Stephen R, Stephen H Westin, Eric PF Lafortune, and Kenneth E Torrance. 2000. <span>“Image-Based Bidirectional Reflectance Distribution Function Measurement.”</span> <em>Applied Optics</em> 39 (16): 2592–2600.
</div>
<div id="ref-matusik2003data" class="csl-entry" role="listitem">
Matusik, Wojciech. 2003. <span>“A Data-Driven Reflectance Model.”</span> PhD thesis, Massachusetts Institute of Technology.
</div>
<div id="ref-nicodemus1977geometrical" class="csl-entry" role="listitem">
Nicodemus, FE, JC Richmond, JJ Hsia, IW Ginsberg, and T Limperis. 1977. <em>Geometrical Considerations and Nomenclature for Reflectance</em>. Vol. 160. US Department of Commerce, National Bureau of Standards Washington, DC, USA.
</div>
<div id="ref-pharr2023physically" class="csl-entry" role="listitem">
Pharr, Matt, Wenzel Jakob, and Greg Humphreys. 2023. <em>Physically Based Rendering: From Theory to Implementation</em>. 4th ed. MIT Press.
</div>
<div id="ref-ramamoorthi2009precomputation" class="csl-entry" role="listitem">
Ramamoorthi, Ravi. 2009. <span>“Precomputation-Based Rendering.”</span> <em>Foundations and Trends<span></span> in Computer Graphics and Vision</em> 3 (4): 281–369.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>To be more rigorous, the integration in <a href="#eq-brdf_finite_3" class="quarto-xref">Equation&nbsp;<span>11.4</span></a> evaluates to <span class="math inline">\(E(p, \Oi) + C\)</span>, where <span class="math inline">\(C\)</span> is a constant. Given the boundary condition that <span class="math inline">\(L(p, \os) = 0\)</span> when <span class="math inline">\(E(p, \Oi) = 0\)</span>, we know <span class="math inline">\(C=0\)</span>, so <span class="math inline">\(C\)</span> is omitted.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>For instance, if <span class="math inline">\(\rho_{hd}(p, \oi) = \frac{1}{1+\oi^2}\)</span>, then <span class="math inline">\(\rho_{dh}(p, \os)\)</span> must take the form <span class="math inline">\(\rho_{dh}(p, \os) = \frac{1}{1+\os^2}\)</span><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>To be exact, the LTE sometimes has an emission term at the right-hand side to denote the spontaneous emission from a surface point.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./rendering-lightfield.html" class="pagination-link" aria-label="Light Field">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Light Field</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./rendering-surface.html" class="pagination-link" aria-label="Modeling Material Surface">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Modeling Material Surface</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/learnvisualcomputing/learnvisualcomputing.github.io/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>